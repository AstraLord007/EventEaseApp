@page "/eventdetails/{Name}"
@inject EventService EventService
@inject SessionService SessionService
@inject NavigationManager NavigationManager
@using EventEaseApp.Data

<div class="event-details-card">
    <h1 class="event-details-title">Detalles del evento</h1>

    <EditForm Model="@selectedEvent" OnValidSubmit="GuardarCambios">
        <DataAnnotationsValidator />
        <ValidationSummary />

        <div class="form-group">
            <label>Nombre:</label>
            <InputText @bind-Value="selectedEvent.Name" class="form-control" />
        </div>

        <div class="form-group">
            <label>Fecha:</label>
            <InputDate @bind-Value="selectedEvent.Date" class="form-control" />
        </div>

        <div class="form-group">
            <label>Ubicación:</label>
            <InputText @bind-Value="selectedEvent.Location" class="form-control" />
        </div>

        <div class="form-group">
            <label>Descripción:</label>
            <InputTextArea @bind-Value="selectedEvent.Description" class="form-control" />
        </div>

        <div class="event-details-actions">
            <button type="submit" class="btn btn-primary">Guardar cambios</button>
            <button type="button" class="btn btn-outline-secondary"
                @onclick="@(() => NavigationManager.NavigateTo("/events"))">
                Volver a la lista
            </button>
        </div>
    </EditForm>

    @if (mensajeGuardado)
    {
        <div class="alert alert-success mt-3">
            ✅ Cambios guardados correctamente, redirigiendo a la lista de eventos...
        </div>
    }
</div>

@code {
    [Parameter] public string Name { get; set; } = string.Empty;
    private Event selectedEvent = new Event();
    private bool mensajeGuardado = false;

    protected override void OnInitialized()
    {
        var ev = EventService.GetEvents().FirstOrDefault(e => e.Name == Name);

        if (ev is not null)
        {
            selectedEvent = ev;
        }
        else
        {
            selectedEvent = new Event
            {
                Name = "Evento no encontrado",
                Date = DateTime.Now,
                Location = "N/A",
                Description = "Sin descripción disponible"
            };
        }
    }

    private void GuardarCambios()
    {
        mensajeGuardado = true;
        NavigationManager.NavigateTo("/events");
    }
}